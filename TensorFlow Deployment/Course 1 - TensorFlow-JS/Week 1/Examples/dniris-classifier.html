<html>
<head></head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script lang="js">
    async function run(){

        const csvUrl = 'iris.csv';
        
        const trainingData = tf.data.csv(csvUrl, {
            columnConfigs: {
                species: {
                    isLabel: true
                }
            }
        });        
        
        const numOfFeatures = (await trainingData.columnNames()).length - 1;
            
        const numOfSamples = 150;
        const convertedData =
              trainingData.map(({xs,ys}) => {
                  const labels = [
                      ys.species == "setosa" ? 1:0,
                      ys.species == "virginica" ? 1:0,
                      ys.species == "verisicolor" ? 1:0
                  ]
                  return{ xs: Object.values(xs), ys:Object.values(labels)};
              }).batch(10);
        
        
        const model = tf.sequential();
        
         model.add(tf.layers.dense({inputShape: [numOfFeatures], activation: "sigmoid", units: 5}))
           
        model.add(tf.layers.dense({
            activation: "softmax", units:3
            }));
                         
        model.compile({
            loss:'categoricalCrossentropy',
            optimizer:tf.train.adam(0.06)
            });
                         
        model.summary();

        await 
        model.fitDataset(convertedData, 
            { epochs: 100,
              callbacks:{
                  onEpochEnd: async(epoch, logs) =>{
                      console.log("E: " 
                                  + epoch 
                                  + " Loss:" 
                                  + logs.loss);

                  }
              }
            });
        
    // Test Cases:

    // Setosa
    // const testVal = tf.tensor2d([4.4, 2.9, 1.4, 0.2], [1, 4]);

    // Versicolor
    // const testVal = tf.tensor2d([6.4, 3.2, 4.5, 1.5], [1, 4]);

    // Virginica
    // const testVal = tf.tensor2d([5.8,2.7,5.1,1.9], [1, 4]);

   
    console.log("testVal is Setosa...")     
        
    // Setosa
    // const testVal = tf.tensor2d([4.4, 2.9, 1.4, 0.2], [1, 4]);
        
    //const  <-- not using const to try do it two times 
        
    const testVal1 = tf.tensor2d([4.4, 2.9, 1.4, 0.2], [1, 4]);
       
    //const <-- not using const to try do it two times 
        
    prediction = model.predict(testVal1)
    
    alert(prediction); // 0.9x, 0.0x, 0.0x 

   

    console.log("testVal is Versicolor...")     
        
    // Versicolor
    // const testVal = tf.tensor2d([6.4, 3.2, 4.5, 1.5], [1, 4]);   
        
    // constant cannot be reassinged !!! 
        
    const testVal2 = tf.tensor2d([6.4, 3.2, 4.5, 1.5], [1, 4]);
       
    prediction = model.predict(testVal2)

    alert(prediction); // strange 0 1 0 -- 0.0x, 0.0x, 0.9x? as below

    
    console.log("testVal is Virginica...")     
        
    // Setosa
    
    const testVal3 = tf.tensor2d([5.8, 2.7, 5.1, 1.9], [1, 4]);
        
    prediction = model.predict(testVal3)
    
    alert(prediction); // still 0 1 0 -- 0.0x, 0.9x, 0.0x? as below
    
    console.log("testVal is Virginica as last", 
            // undefined testVal[1,1], 
            // undefined, prediction[0],       
            "testVal1 obj:\n",
                testVal1,
            "prediction obj:\n",
            prediction)
    
    }
    
    run();
</script>   
<body>
    <h1> Dn Iris Fisher Classifier (dn)</h1>
</body>
</html>